@model HelpDeskKyotera.ViewModels.PagedResult<HelpDeskKyotera.Models.Ticket>

@{
    ViewData["Title"] = "My Tickets";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid my-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="fw-bold">My Submitted Tickets</h1>
            <p class="text-muted">Total: @Model.TotalCount tickets</p>
        </div>
    </div>

    @if (Model.Items.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Ticket Number</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Assigned To</th>
                        <th>Created On</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ticket in Model.Items)
                    {
                        <tr>
                            <td>
                                <a href="/Tickets/Details/@ticket.TicketId" class="text-decoration-none fw-semibold">
                                    @ticket.TicketNumber
                                </a>
                            </td>
                            <td>@ticket.Title</td>
                            <td>@ticket.Category?.Name</td>
                            <td>
                                @if (ticket.Priority != null)
                                {
                                    <span class="badge bg-warning">@ticket.Priority.Name</span>
                                }
                            </td>
                            <td>
                                @if (ticket.Status != null)
                                {
                                    <span class="badge bg-info">@ticket.Status.Name</span>
                                }
                            </td>
                            <td>
                                @if (ticket.AssignedTo != null)
                                {
                                    <span>@ticket.AssignedTo.FirstName @ticket.AssignedTo.LastName</span>
                                }
                                else
                                {
                                    <span class="text-muted">Unassigned</span>
                                }
                            </td>
                            <td>@ticket.CreatedOn.ToString("MMM dd, yyyy")</td>
                            <td>
                                <a href="/Tickets/Details/@ticket.TicketId" class="btn btn-sm btn-info">View</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        @if (Model.TotalCount > Model.PageSize)
        {
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    @{
                        int pageNumber = ViewBag.PageNumber ?? 1;
                        int pageSize = ViewBag.PageSize ?? 10;
                        int totalPages = (int)Math.Ceiling((double)Model.TotalCount / pageSize);
                    }

                    @if (pageNumber > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" asp-action="MyTickets" asp-route-pageNumber="1">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" asp-action="MyTickets" asp-route-pageNumber="@(pageNumber - 1)">Previous</a>
                        </li>
                    }

                    @for (int i = Math.Max(1, pageNumber - 2); i <= Math.Min(totalPages, pageNumber + 2); i++)
                    {
                        @if (i == pageNumber)
                        {
                            <li class="page-item active">
                                <span class="page-link">@i</span>
                            </li>
                        }
                        else
                        {
                            <li class="page-item">
                                <a class="page-link" asp-action="MyTickets" asp-route-pageNumber="@i">@i</a>
                            </li>
                        }
                    }

                    @if (pageNumber < totalPages)
                    {
                        <li class="page-item">
                            <a class="page-link" asp-action="MyTickets" asp-route-pageNumber="@(pageNumber + 1)">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" asp-action="MyTickets" asp-route-pageNumber="@totalPages">Last</a>
                        </li>
                    }
                </ul>
            </nav>
        }
    }
    else
    {
        <div class="alert alert-info" role="alert">
            <p class="mb-0">You have not submitted any tickets yet.</p>
            <a href="/Tickets/Create" class="btn btn-sm btn-primary mt-2">Create Your First Ticket</a>
        </div>
    }

    <div class="mt-4">
        <a asp-action="Index" class="btn btn-outline-secondary">Back to Dashboard</a>
    </div>
</div>
